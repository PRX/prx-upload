<div>
   <input type="file" id="files"  multiple />
<div>


<script language="javascript">

   var files;

   var _e_ = new Evaporate({
      signerUrl: '/signature',
      aws_key: "<%= ENV['AWS_KEY'] %>",
      bucket: "<%= ENV['AWS_BUCKET'] %>",
   });

   $('#files').change(function(evt){
      files = evt.target.files;

      for (var i = 0; i < files.length; i++){

         _e_.add({
            name: 'test_' + Math.floor(1000000000*Math.random()),
            file: files[i],
            notSignedHeadersAtInitiate: {
               'Cache-Control': 'max-age=3600'
            },
            xAmzHeadersAtInitiate : {
               'x-amz-acl': 'public-read'
            },
            signParams: {
               foo: 'bar'
            },
            complete: function(){
               console.log('complete................yay!');
            },
            progress: function(progress){
               console.log('making progress: ' + progress);
            }
         });
      }

      $(evt.target).val('');

   });

</script>
